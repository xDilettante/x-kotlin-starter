<!-- Файл: /AGENTS.md -->

# Repository Guidelines

## Назначение
Этот файл описывает правила работы с репозиторием для автоматизированных агентов и разработчиков: структура, команды, стиль, тестирование, правила изменений.

## Политика изменения AGENTS.md
- Этот файл коммитится в репозиторий и должен отражать актуальные правила проекта.
- Разрешено обновлять `AGENTS.md`, если:
    - добавлен/удалён модуль;
    - изменились команды сборки/запуска/генерации;
    - изменились обязательные шаги проверки (CI, линтеры, форматтеры).
- Запрещено менять правила безопасности/архитектурные договорённости без явного задания (например, ослаблять запрет на секреты).

## Локальные правила (не коммитить)
- Локальные подсказки/пути/временные workaround’ы хранить в `AGENTS.local.md`.
- `AGENTS.local.md` добавить в `.gitignore`.

## Структура проекта и модули
- Корень Gradle: `build.gradle.kts`, `settings.gradle.kts`, `libs.versions.toml`.
- Активные модули: `xUtils`, `xLogging`, `xRayProto`, `xAppTest` (см. `settings.gradle.kts`).
- Исходники Kotlin: `src/main/kotlin`, тесты: `src/test/kotlin`, ресурсы: `src/main/resources` и `src/test/resources`.
- Прото-файлы: `xRayProto/src/main/proto`, генерация — плагин protobuf в Gradle.
- `xEmptyApp` и `xEmptyLib` не подключены; использовать как шаблоны без изменения структуры модулей.

## Команды (Linux/Bash)
- `./gradlew build` — сборка всех модулей и запуск тестов.
- `./gradlew test` — запуск всех тестов.
- `./gradlew :xAppTest:run` — запуск приложения `xAppTest`.
- `./gradlew :xRayProto:generateProto` — генерация protobuf/gRPC кода.
- `./gradlew :xLogging:build` — сборка одного модуля.

## Генерация кода (protobuf/gRPC)
- После изменения файлов `.proto` обязательно запускать:
    - `./gradlew :xRayProto:generateProto`
- Политика коммита сгенерированных файлов:
    - (выбрать одно) Сгенерированный код: [КОММИТИТСЯ / НЕ КОММИТИТСЯ].
    - Если коммитится: убедиться, что после генерации `git diff` не содержит “случайных” изменений.
    - Если не коммитится: CI/сборка должны генерировать всё сами.

## Стиль кода и именование
- Отступы: 4 пробела, без табов; придерживаться стандартного стиля Kotlin.
- Пакеты — в нижнем регистре, классы и файлы — PascalCase.
- Вывод в консоль и комментарии в коде — на русском языке.
- Форматтер/линтер не настроены, ориентироваться на существующий стиль.

## Тестирование
- Тесты размещать в `src/test/kotlin` с зеркальной структурой пакетов.
- Запуск: `./gradlew test` или `./gradlew :moduleName:test`.
- Явный фреймворк тестирования не закреплен; добавляйте зависимости в модуль по необходимости.

## Конфигурация и зависимости
- JDK задается в `libs.versions.toml` (`jdk = 21`) и применяется через toolchain.
- Версии зависимостей и плагинов — в `libs.versions.toml`.
- Версия Gradle Wrapper — `gradle/wrapper/gradle-wrapper.properties`.

## Проверки перед коммитом (минимум)
- `./gradlew test`
- `./gradlew build`
- Если трогали `.proto`: `./gradlew :xRayProto:generateProto`

## Коммиты и PR
- Не коммитить секреты: ключи, токены, пароли, приватные сертификаты.
- Делать маленькие, логически завершенные коммиты.
- В сообщениях коммитов — короткое описание в повелительной форме на русском.
- В PR: описание изменений, шаги проверки, ссылки на задачи при наличии.